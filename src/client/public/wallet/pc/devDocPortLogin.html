<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>钱包平台</title>
    <link rel="stylesheet" href="css/up.css">
</head>
<body>
      <div class="head_box">
          <div class="inner">
              <h1 class="logo">
                  <a href="up.html"> <img title="银联钱包开放平台" src="image/sample.png"/></a>
              </h1>

          </div>
      </div>

  <div class="container_box">
      <div class="col_side">
          <div class="portal">
              <h5><span class="arrow"></span>第三方商户接入接口说明</h5>
              <div>
                  <ul>
                      <li class="cour"><a href="devDocPortLogin.html">用户联登</a></li>
                      <li><a href="devDocPortUIPlugin.html">调用钱包UI插件功能</a></li>
                      <li><a href="devDocPortDemo.html">DEMO代码</a></li>
                  </ul>
              </div>
          </div>
          <div class="portal">
              <h5><span class="arrow"></span>钱包网页开发</h5>
              <div style="display:none">
                  <ul>
                      <li><a>钱包网页授权</a></li>
                      <li><a>钱包网页样式库</a></li>
                      <li><a>钱包UP-SDK说明</a></li>
                      <li><a>钱包开发者工具</a></li>
                  </ul>
              </div>
          </div>



      </div>
      <div class="col_main">
          <h2 class="tit">一、用户联登</h2>
          <div class="port">
              <h4 class="port_tit">1) 使用场景</h4>
              <p>
                  商户侧需要获取钱包登录用户的信息并且对用户进行唯一标记。如果仅需要openid,则使用静默授权，否则需要用户同意，显示授权。
              </p>
              <h4 class="port_tit">2) 前置条件 </h4>
              <p>
                  a) 登录钱包商户接入平台，填写商户名称，营业执照等信息（包括商户侧OAUTH授权回调域名），钱包后台会分配商户appid, secret。
              </p>
              <p>b) 商户侧后台需与钱包后台对接，为安全起见，appid, secret需要放置在接入方后台，不要暴露在前端H5页面。</p>
              <h4 class="port_tit">3) 对接步骤</h4>
              <p class="step">
                  第一步：用户同意授权，获取code
              </p>
              <p>接入方H5跳转到此页面，请求获取code。 </p>
              <p>https://open.95516.com/s/wl/web/upsdk/oauth/html/oauth.html?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE
              </p>
              <p class="detail">参考链接(请在钱包客户端中打开此链接体验)
                  假定Scope为upapi_base https://open.95516.com/s/wl/web/upsdk/oauth/html/oauth.html?appid=up520c15f417810387&redirect_uri=https%3A%2F%2Fm.haigou.unionpay.com%2Fphp%2Findex.php%3Fd%3D%26c%3DwxAdapter%26m%3DmobileDeal%26showwxpaytitle%3D1%26vb2ctag%3D4_2030_5_1194_60&response_type=code&scope=upapi_base&state=123
              </p>
              <p class="suggest">强烈建议：跳转回调redirect_uri使用https链接来确保授权code的安全性。</p>
              <table>
                 <tr class="thead">
                     <th style="width:110px">参数</th><th style="width:80px;">是否必须</th><th>说明</th>
                 </tr>
                  <tr>
                      <td>appid</td><td>是</td><td>接入方的唯一标识</td>
                  </tr>
                  <tr>
                      <td>redirect_uri</td><td>是</td><td>授权后重定向的回调链接地址，请使用urlencode对链接进行处理</td>
                  </tr>
                  <tr>
                      <td>response_type</td><td>是</td><td>返回类型，请填写code</td>
                  </tr>
                  <tr>
                      <td>scope</td><td>是</td><td>应用授权作用域，upapi_base （不弹出授权页面，直接跳转，只能获取用户openid），upapi_userinfo （弹出授权页面，可通过openid拿到登录手机号，昵称等信信息）</td>
                  </tr>
                  <tr>
                      <td>state</td><td>是</td><td>重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节</td>
                  </tr>
              </table>
              <p>
              <img src="image/author.jpg"/>
              </p>
              <p>如果用户同意授权，页面将跳转至 redirect_uri/?code=CODE&state=STATE；若用户禁止授权，则重定向后不会带上code参数，仅会带上state参数redirect_uri?state=STATE</p>
              <p class="step">第二步：通过code换取网页授权access_token</p>
              <p>获取code后，请求以下链接获取access_token， 商户端后台与钱包后台直接对接：
                  https://open.95516.com/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code</p>
              <p>输入参数说明:</p>
              <table>
                  <tr class="thead"><th>参数</th><th>是否必须</th><th>说明</th></tr>
                  <tr><td>appid</td><td>是</td><td>接入方的唯一标识</td></tr>
                  <tr><td>secret</td><td>是</td><td>接入方的appsecret</td></tr>
                  <tr><td>code</td><td>是</td><td>填写第一步获取的code参数</td></tr>
                  <tr><td>grant_type</td><td>是</td><td>填写为authorization_code</td></tr>
              </table>
              <p>返回说明:</p>
              <p class="detail">
                  正确时返回的JSON数据包如下：<br/>
                  {<br/>
                  "access_token":"ACCESS_TOKEN",<br/>
                  "expires_in":7200,<br/>
                  "refresh_token":"REFRESH_TOKEN",<br/>
                  "openid":"OPENID",<br/>
                  "scope":"SCOPE"<br/>
                  } </p>
              <p>返回接口说明：</p>
              <table>
                  <tr class="thead"><th>参数</th><th>说明</th></tr>
                  <tr><td>access_token</td><td>网页授权接口调用凭证 </td></tr>
                  <tr><td>expires_in</td><td>access_token接口调用凭证超时时间，单位（秒）</td></tr>
                  <tr><td>refresh_token</td><td>用户刷新access_token</td></tr>
                  <tr><td>Opened</td><td>用户唯一标识</td></tr>
                  <tr><td>Scope</td><td>用户授权的作用域 upapi_base或者 upapi_userinfo</td></tr>

              </table>
              <p>access_token有效期为7天，当access_token超时后，可以使用refresh_token进行刷新，</p>
              <p>refresh_token有效期为28天，只能更新一次，当refresh_token失效的后，需要用户重新授权。</p>
              <p>   错误时钱包后台会返回JSON数据包如下（示例为code无效错误）:</p>
              <p class="detail">
                  {"errcode":40029," errmsg":"invalid code"}
              </p>
              <p class="suggestBlue">如果是静默授权(upapi_base)，openid已经获取，下面的步骤就不用了。</p>
              <p class="suggest">如下的内容都是为显示授权准备的，通过openid, 接入方再去获取授权给他的资源信息。    </p>
              <p class="step">第三步：拉取用户信息(需scope为 upapi _userinfo)</p>
              <p>如果网页授权作用域为upapi_userinfo，则此时开发者可以通过access_token和openid拉取用户信息了。</p>
              <p>请求方法</p>
              <p>http：GET（请使用https协议） </p>
              <p>https://open.95516.com/oauth2/userinfo?access_token=ACCESS_TOKEN&openid=OPENID </p>
              <p>参数说明</p>
              <table>
                  <tr class="thead"><th>参数</th><th>说明</th></tr>
                  <tr><td>access_token</td><td>网页授权接口调用凭证</td></tr>
                  <tr><td>openid</td><td>用户的唯一标识</td></tr>
              </table>
              <p>返回说明</p>
              <p>正确时返回的JSON数据包如下：</p>
              <p class="detail">
                  {<br/>
                  "access_token":"ACCESS_TOKEN",<br/>
                  "expires_in":7200,<br/>
                  "refresh_token":"REFRESH_TOKEN",<br/>
                  "openid":"OPENID",<br/>
                  "scope":"SCOPE"<br/>
                  }
              </p>
              <p>错误时钱包后台会返回JSON数据包如下（示例为openid无效）:</p>
              <p class="detail">{"errcode":40003, "errmsg":" invalid openid "} </p>
          </div>


      </div>



  </div>
  <div class="foot_box">
      <div class="inner">
          <ul class="link">
              <li class="link_item first"><a target="_blank" href="">关于我们</a></li>
              <li class="link_item"><a target="_blank" href="">服务协议</a></li>
              <li class="link_item"><a target="_blank" href="">安全中心</a></li>
              <li class="link_item"><a target="_blank" href="">用户反馈</a></li>
          </ul>
      </div>
  </div>
      <script type="text/javascript" src="js/jquery.js"></script>
      <script type="text/javascript" src="js/devDoc.js"></script>
</body>
</html>
